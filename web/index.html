<!DOCTYPE html>
<html lang="en">
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  
  <!-- Critical performance meta tags -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="format-detection" content="telephone=no">
  
  <!-- SEO and PWA meta tags -->
  <title>Deep Link Demo - Fast Flutter PWA</title>
  <meta name="description" content="Experience lightning-fast deep linking with our optimized Flutter PWA. Seamless navigation across all devices.">
  <meta name="keywords" content="Flutter, Deep Links, PWA, Fast Loading, Mobile Web, Performance">
  <meta name="author" content="Deep Link Demo">
  <meta name="theme-color" content="#667eea">
  
  <!-- DNS prefetch for external resources -->
  <link rel="dns-prefetch" href="//fonts.googleapis.com">
  <link rel="dns-prefetch" href="//fonts.gstatic.com">
  
  <!-- Preconnect to critical external resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Preload critical resources for faster loading -->
  <link rel="preload" href="flutter_bootstrap.js" as="script" crossorigin>
  <link rel="preload" href="main.dart.js" as="script" crossorigin>
  <link rel="preload" href="flutter_service_worker.js" as="script">
  
  <!-- Preload critical fonts -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Inter:wght@300;400;500&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  
  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Optimized favicon and icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="apple-touch-icon" sizes="192x192" href="icons/Icon-192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="icons/Icon-512.png">
  
  <!-- iOS PWA optimizations -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Deep Link Demo">
  
  <!-- Microsoft PWA optimizations -->
  <meta name="msapplication-TileColor" content="#667eea">
  <meta name="msapplication-config" content="browserconfig.xml">
  
  <!-- Critical CSS inlined for fastest rendering -->
  <style>
    /* Reset and base styles */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    
    html {
      -webkit-text-size-adjust: 100%;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow-x: hidden;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    /* Optimized loading screen with GPU acceleration */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 9999;
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
    }
    
    .loading.fade-out {
      opacity: 0;
      visibility: hidden;
    }
    
    /* High-performance spinner with transform3d */
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(255,255,255,0.2);
      border-top: 4px solid rgba(255,255,255,0.9);
      border-radius: 50%;
      animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
      will-change: transform;
      transform: translateZ(0);
    }
    
    @keyframes spin {
      0% { transform: translateZ(0) rotate(0deg); }
      100% { transform: translateZ(0) rotate(360deg); }
    }
    
    /* Loading text with fade animation */
    .loading-text {
      color: rgba(255,255,255,0.95);
      margin-top: 24px;
      font-size: 16px;
      font-weight: 300;
      letter-spacing: 0.5px;
      animation: pulse 2s ease-in-out infinite alternate;
    }
    
    @keyframes pulse {
      from { opacity: 0.7; }
      to { opacity: 1; }
    }
    
    /* Progress bar for loading feedback */
    .progress-container {
      width: 240px;
      height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
      margin-top: 20px;
      overflow: hidden;
      position: relative;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, rgba(255,255,255,0.8), rgba(255,255,255,1));
      border-radius: 2px;
      width: 0%;
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
      width: 40px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4));
      animation: shimmer 1.5s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-40px); }
      100% { transform: translateX(240px); }
    }
    
    /* Flutter app container optimization */
    #flutter-app {
      opacity: 0;
      transition: opacity 0.6s ease-in;
      will-change: opacity;
    }
    
    #flutter-app.loaded {
      opacity: 1;
    }
    
    /* Prevent FOUC (Flash of Unstyled Content) */
    flt-glass-pane {
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    
    flt-glass-pane.ready {
      opacity: 1;
    }
    
    /* Responsive optimizations */
    @media (max-width: 768px) {
      .spinner {
        width: 40px;
        height: 40px;
        border-width: 3px;
      }
      
      .loading-text {
        font-size: 14px;
      }
      
      .progress-container {
        width: 200px;
      }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      .loading-text {
        color: rgba(255,255,255,0.98);
      }
    }
    
    /* Reduce motion for accessibility */
    @media (prefers-reduced-motion: reduce) {
      .spinner {
        animation: spin 2s linear infinite;
      }
      
      .loading-text {
        animation: none;
      }
      
      .progress-bar::after {
        animation: none;
      }
    }
  </style>
  
</head>
<body>
  <!-- Optimized loading screen -->
  <div id="loading" class="loading" role="status" aria-label="Loading application">
    <div>
      <div class="spinner" aria-hidden="true"></div>
      <div class="loading-text">Loading Deep Link Demo...</div>
      <div class="progress-container">
        <div id="progress-bar" class="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Flutter application container -->
  <div id="flutter-app"></div>

  <!-- Critical JavaScript for loading optimization -->
  <script>
    // Performance monitoring
    const perfStart = performance.now();
    let loadingStage = 0;
    const stages = ['Initializing...', 'Loading resources...', 'Starting Flutter...', 'Almost ready...'];
    
    // Progress simulation for better UX
    function updateProgress() {
      const progressBar = document.getElementById('progress-bar');
      const loadingText = document.querySelector('.loading-text');
      
      if (loadingStage < stages.length) {
        loadingText.textContent = stages[loadingStage];
        progressBar.style.width = (loadingStage + 1) * 25 + '%';
        loadingStage++;
        
        if (loadingStage < stages.length) {
          setTimeout(updateProgress, 600 + Math.random() * 400);
        }
      }
    }
    
    // Start progress simulation
    setTimeout(updateProgress, 300);
    
    // Hide loading screen when Flutter is ready
    function hideLoading() {
      const loading = document.getElementById('loading');
      const flutterApp = document.getElementById('flutter-app');
      
      if (loading && flutterApp) {
        // Ensure progress is complete
        const progressBar = document.getElementById('progress-bar');
        const loadingText = document.querySelector('.loading-text');
        
        progressBar.style.width = '100%';
        loadingText.textContent = 'Ready!';
        
        setTimeout(() => {
          loading.classList.add('fade-out');
          flutterApp.classList.add('loaded');
          
          // Performance logging
          const loadTime = performance.now() - perfStart;
          console.log(`App loaded in ${loadTime.toFixed(2)}ms`);
          
          // Remove loading element after animation
          setTimeout(() => {
            if (loading.parentNode) {
              loading.parentNode.removeChild(loading);
            }
          }, 600);
        }, 400);
      }
    }
    
    // Listen for Flutter app ready events
    window.addEventListener('flutter-first-frame', hideLoading);
    window.addEventListener('load', () => {
      // Fallback in case flutter-first-frame doesn't fire
      setTimeout(hideLoading, 3000);
    });
    
    // Service Worker registration with error handling
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('flutter_service_worker.js', {
          scope: '/'
        }).then(function(registration) {
          console.log('ServiceWorker registration successful');
          
          // Update available notification
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                console.log('New version available! Refresh to update.');
              }
            });
          });
        }).catch(function(error) {
          console.log('ServiceWorker registration failed: ', error);
        });
      });
    }
    
    // Critical font loading optimization
    if ('fonts' in document) {
      document.fonts.load('1em Poppins').then(() => {
        document.documentElement.classList.add('fonts-loaded');
      });
    }
    
    // Connection awareness for performance optimization
    if ('connection' in navigator) {
      const connection = navigator.connection;
      if (connection && connection.effectiveType) {
        document.documentElement.setAttribute('data-connection', connection.effectiveType);
        
        // Adjust loading behavior based on connection speed
        if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
          document.documentElement.classList.add('slow-connection');
        }
      }
    }
  </script>
  
  <!-- Flutter bootstrap with optimized loading -->
  <script src="flutter_bootstrap.js" async defer></script>
</body>
</html>